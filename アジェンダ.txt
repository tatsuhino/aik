■■メンバ紹介
■■中間発表の振り返り
発表内容
ナレッジ検索基盤を構築するつもりだったけど、
より機械学習の研究にフォーカスするため、レコメンドにフォーカスした。
検索エンジンとして利用する場合には、大量のデータがある。探すのが大変。

会社として、レコメンドに強くなることによるメリットはないか？
多くのアイテムから選択する。

社内への適用
・新卒採用。配属
・日々増えていくナレッジの検索

案件への適用
・事業推進企画部のやつ


■■目標とする成果

社内に還元できるようなレコメンドノウハウの
ロードマップ
・レコメンドの技術について研究
・全社ナレッジ検索に適用
・案件適用

■■研究テーマに対する現状認識

■レコメンドとは
・レコメンドの種類
コンテンツベース
協調フィルタリング

■協調フィルタリングの課題

でも、協調フィルタリングでは・・・
★ユースケース
いつもはこのワードで検索していた。
いまはプレゼン資料ように使える絵が欲しい
→いつもとは違う検索行動に対して、適切にレコメンドできない

■Doc2Vecを活用したレコメンドについて
楽天の論文を発見！
時系列(順番)を扱えるようになった。

■■研究プロセス（協調フィルタリング＋Doc2Vec）
・データ準備
・データ整形
・モデル構築
・評価

■データ準備
対象データは、検索エンジンで適用することを想定して、
閲覧履歴、購入履歴が時系列順に出力されているものを使用

閲覧、閲覧、閲覧、購入の流れに整形
この時点で可視化したら、同じ購入アイテムを買った閲覧履歴ベクトルは似ていることが分かった。

■データ整形
ノイズを除去

■モデル構築
パラメータは検討しました。

■■評価
・よく買われているアイテムの上位何件
・協調フィルタリングのユーザベース
・Doc2Vecの履歴

■■まとめ



=============================
def convert(input_file_name):
"""
'ユーザID アイテムID 評価値'のフォーマットへ変換してファイルに出力する
"""
output_file_name = input_file_name + '_converted' # 変換後のファイル名
output = ''

with open(input_file_name, mode='r') as f:
lines = f.readlines()

user_id = 0
for line in lines:
words = line.strip().split(' ')
for item_id, word in enumerate(words):
score = int(word)
if score != -1:
output += '{0:04d} {1:02d} {2:01d}\n'.format(user_id, item_id, score)

user_id += 1

with open(output_file_name, mode='w') as f:
f.write(output)

return output_file_name


file_name = convert('/tmp/sushi3-2016/sushi3b.5000.10.score')

=============================

その後、一つ目のアルゴリズムとして、SVDアルゴリズムに関してパラメータの最適化を行います。

===============================
from surprise import SVD
from surprise import Dataset
from surprise import Reader
from surprise.model_selection import GridSearchCV

# Use 'sushi3b.5000.10.score_converted'
reader = Reader(line_format='user item rating', sep=' ')
data = Dataset.load_from_file(file_name, reader=reader)

param_grid = {'n_epochs': [5, 10], 'lr_all': [0.002, 0.005],
'reg_all': [0.4, 0.6]}
gs = GridSearchCV(SVD, param_grid, measures=['rmse', 'mae'], cv=10)

gs.fit(data)

# best RMSE score
print(gs.best_score['rmse'])

# combination of parameters that gave the best RMSE score
print(gs.best_params['rmse'])

print(gs.cv_results)
===============================

このSVD以外にも、SVDppとかNMFとか色々あります。
注意してほしいのは、アルゴリズムが変わるとパラメータが変わることです。

上のparam_gridでは、'n_epochs'と'lr_all'と'reg_all'の3つを変動させていますが、これはSVDのパラメータであって、それ以外のアルゴリズムでは変わります。

以下を参考に、どんなパラメータがあるのか、その範囲をどう設定すればいいのか勉強してください。
http://surprise.readthedocs.io/en/stable/prediction_algorithms_package.html

